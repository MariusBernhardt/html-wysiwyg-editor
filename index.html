<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WYSIWYG HTML Editor</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: #2c3e50;
            color: white;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 1.5rem;
        }

        .project-controls {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .btn:hover {
            background: #2980b9;
        }

        .btn.danger {
            background: #e74c3c;
        }

        .btn.danger:hover {
            background: #c0392b;
        }

        .btn.success {
            background: #27ae60;
        }

        .btn.success:hover {
            background: #229954;
        }

        .main-container {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .sidebar {
            width: 250px;
            background: white;
            border-right: 1px solid #ddd;
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            padding: 1rem;
            background: #ecf0f1;
            border-bottom: 1px solid #ddd;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .pages-list {
            flex: 1;
            overflow-y: auto;
        }

        .page-item {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .page-item:hover {
            background: #f8f9fa;
        }

        .page-item.active {
            background: #3498db;
            color: white;
        }

        .page-item .page-name {
            flex: 1;
        }

        .page-item .page-actions {
            display: flex;
            gap: 0.5rem;
        }

        .page-action {
            background: none;
            border: none;
            cursor: pointer;
            padding: 0.25rem;
            border-radius: 2px;
            font-size: 0.8rem;
        }

        .page-action:hover {
            background: rgba(0,0,0,0.1);
        }

        .editor-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: white;
        }

        .toolbar {
            background: #f8f9fa;
            border-bottom: 1px solid #ddd;
            padding: 0.5rem;
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .toolbar-btn {
            background: white;
            border: 1px solid #ddd;
            padding: 0.5rem;
            cursor: pointer;
            border-radius: 3px;
            font-size: 0.9rem;
            min-width: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .toolbar-btn:hover {
            background: #e9ecef;
        }

        .toolbar-btn.active {
            background: #3498db;
            color: white;
            border-color: #3498db;
        }

        .toolbar-separator {
            width: 1px;
            background: #ddd;
            margin: 0 0.25rem;
        }

        .editor-tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 1px solid #ddd;
        }

        .editor-tab {
            padding: 0.75rem 1rem;
            background: #e9ecef;
            border: none;
            border-right: 1px solid #ddd;
            cursor: pointer;
        }

        .editor-tab.active {
            background: white;
            border-bottom: 1px solid white;
            margin-bottom: -1px;
        }

        .editor-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .editor {
            flex: 1;
            padding: 1rem;
            outline: none;
            overflow-y: auto;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            font-size: 16px;
        }

        .editor h1, .editor h2, .editor h3, .editor h4, .editor h5, .editor h6 {
            margin: 1rem 0 0.5rem 0;
        }

        .editor p {
            margin: 0.5rem 0;
        }

        .editor ul, .editor ol {
            margin: 0.5rem 0;
            padding-left: 2rem;
        }

        .editor blockquote {
            margin: 1rem 0;
            padding: 0.5rem 1rem;
            border-left: 4px solid #3498db;
            background: #f8f9fa;
        }

        .code-editor {
            flex: 1;
            font-family: 'Monaco', 'Consolas', 'Courier New', monospace;
            padding: 1rem;
            border: none;
            outline: none;
            resize: none;
            font-size: 14px;
            line-height: 1.5;
            background: #2c3e50;
            color: #ecf0f1;
        }

        .preview-frame {
            flex: 1;
            border: none;
            background: white;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            min-width: 300px;
            max-width: 80%;
        }

        .modal-header {
            margin-bottom: 1rem;
            font-size: 1.2rem;
            font-weight: bold;
        }

        .modal-body {
            margin-bottom: 1rem;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 0.5rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: bold;
        }

        .form-group input {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }

        @media (max-width: 768px) {
            .main-container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: 200px;
            }
            
            .toolbar {
                flex-wrap: wrap;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>WYSIWYG HTML Editor</h1>
        <div class="project-controls">
            <button class="btn" onclick="saveProject()">üíæ Save Project</button>
            <button class="btn" onclick="loadProject()">üìÇ Load Project</button>
            <button class="btn success" onclick="exportProject()">üì§ Export HTML</button>
        </div>
    </div>

    <div class="main-container">
        <div class="sidebar">
            <div class="sidebar-header">
                <h3>Pages</h3>
                <button class="btn" onclick="createNewPage()">+ New Page</button>
            </div>
            <div class="pages-list" id="pagesList">
                <div class="page-item active" data-page-id="home">
                    <span class="page-name">Home</span>
                    <div class="page-actions">
                        <button class="page-action" onclick="renamePage('home')" title="Rename">‚úèÔ∏è</button>
                        <button class="page-action" onclick="deletePage('home')" title="Delete">üóëÔ∏è</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="editor-container">
            <div class="toolbar">
                <button class="toolbar-btn" onclick="formatText('bold')" title="Bold"><strong>B</strong></button>
                <button class="toolbar-btn" onclick="formatText('italic')" title="Italic"><em>I</em></button>
                <button class="toolbar-btn" onclick="formatText('underline')" title="Underline"><u>U</u></button>
                <div class="toolbar-separator"></div>
                <button class="toolbar-btn" onclick="formatText('formatBlock', 'h1')" title="Heading 1">H1</button>
                <button class="toolbar-btn" onclick="formatText('formatBlock', 'h2')" title="Heading 2">H2</button>
                <button class="toolbar-btn" onclick="formatText('formatBlock', 'h3')" title="Heading 3">H3</button>
                <button class="toolbar-btn" onclick="formatText('formatBlock', 'p')" title="Paragraph">P</button>
                <div class="toolbar-separator"></div>
                <button class="toolbar-btn" onclick="formatText('insertUnorderedList')" title="Bullet List">‚Ä¢ List</button>
                <button class="toolbar-btn" onclick="formatText('insertOrderedList')" title="Numbered List">1. List</button>
                <button class="toolbar-btn" onclick="formatText('formatBlock', 'blockquote')" title="Quote">‚ùù</button>
                <div class="toolbar-separator"></div>
                <button class="toolbar-btn" onclick="insertLink()" title="Insert Link">üîó</button>
                <button class="toolbar-btn" onclick="insertImage()" title="Insert Image">üñºÔ∏è</button>
                <div class="toolbar-separator"></div>
                <button class="toolbar-btn" onclick="formatText('undo')" title="Undo">‚Ü∂</button>
                <button class="toolbar-btn" onclick="formatText('redo')" title="Redo">‚Ü∑</button>
                <div class="toolbar-separator"></div>
                <button class="toolbar-btn" onclick="formatHtmlCode()" title="Format HTML">üìê</button>
            </div>

            <div class="editor-tabs">
                <button class="editor-tab active" onclick="switchTab('visual')">Visual</button>
                <button class="editor-tab" onclick="switchTab('code')">HTML</button>
                <button class="editor-tab" onclick="switchTab('preview')">Preview</button>
            </div>

            <div class="editor-area">
                <div id="visualEditor" class="editor" contenteditable="true">
                    <h1>Welcome to Your Website</h1>
                    <p>Start editing this page by clicking here and typing. Use the toolbar above to format your content.</p>
                    <p>You can create additional pages using the sidebar on the left.</p>
                </div>
                <textarea id="codeEditor" class="code-editor" style="display: none;"></textarea>
                <iframe id="previewFrame" class="preview-frame" style="display: none;"></iframe>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div id="newPageModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">Create New Page</div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="newPageName">Page Name:</label>
                    <input type="text" id="newPageName" placeholder="Enter page name">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="closeModal('newPageModal')">Cancel</button>
                <button class="btn success" onclick="confirmCreatePage()">Create</button>
            </div>
        </div>
    </div>

    <div id="renamePageModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">Rename Page</div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="renamePageName">New Page Name:</label>
                    <input type="text" id="renamePageName" placeholder="Enter new page name">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="closeModal('renamePageModal')">Cancel</button>
                <button class="btn success" onclick="confirmRenamePage()">Rename</button>
            </div>
        </div>
    </div>

    <div id="linkModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">Insert Link</div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="linkText">Link Text:</label>
                    <input type="text" id="linkText" placeholder="Enter link text">
                </div>
                <div class="form-group">
                    <label for="linkUrl">URL:</label>
                    <input type="text" id="linkUrl" placeholder="Enter URL">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="closeModal('linkModal')">Cancel</button>
                <button class="btn success" onclick="confirmInsertLink()">Insert</button>
            </div>
        </div>
    </div>

    <div id="imageModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">Insert Image</div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="imageUrl">Image URL:</label>
                    <input type="text" id="imageUrl" placeholder="Enter image URL">
                </div>
                <div class="form-group">
                    <label for="imageAlt">Alt Text:</label>
                    <input type="text" id="imageAlt" placeholder="Enter alt text">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="closeModal('imageModal')">Cancel</button>
                <button class="btn success" onclick="confirmInsertImage()">Insert</button>
            </div>
        </div>
    </div>

    <script>
        let currentPage = 'home';
        let currentTab = 'visual';
        let pages = {
            'home': {
                name: 'Home',
                content: '<h1>Welcome to Your Website</h1><p>Start editing this page by clicking here and typing. Use the toolbar above to format your content.</p><p>You can create additional pages using the sidebar on the left.</p>'
            }
        };
        let pageIdCounter = 1;
        let renamingPageId = null;

        // Initialize the editor
        function init() {
            loadFromLocalStorage();
            updatePagesList();
            loadPage(currentPage);
            
            // Auto-save functionality
            setInterval(saveToLocalStorage, 30000); // Auto-save every 30 seconds
            
            // Update code editor when visual editor changes
            document.getElementById('visualEditor').addEventListener('input', syncVisualToCode);
            document.getElementById('codeEditor').addEventListener('input', syncCodeToVisual);
        }

        // Page management
        function createNewPage() {
            showModal('newPageModal');
            document.getElementById('newPageName').value = '';
            document.getElementById('newPageName').focus();
        }

        function confirmCreatePage() {
            const pageName = document.getElementById('newPageName').value.trim();
            if (!pageName) {
                alert('Please enter a page name');
                return;
            }

            const pageId = 'page_' + (++pageIdCounter);
            pages[pageId] = {
                name: pageName,
                content: '<h1>' + pageName + '</h1><p>Start editing this page...</p>'
            };

            updatePagesList();
            switchToPage(pageId);
            closeModal('newPageModal');
            saveToLocalStorage();
        }

        function renamePage(pageId) {
            if (pageId === 'home' && Object.keys(pages).length === 1) {
                return; // Don't allow renaming if it's the only page
            }
            
            renamingPageId = pageId;
            document.getElementById('renamePageName').value = pages[pageId].name;
            showModal('renamePageModal');
            document.getElementById('renamePageName').focus();
        }

        function confirmRenamePage() {
            const newName = document.getElementById('renamePageName').value.trim();
            if (!newName) {
                alert('Please enter a page name');
                return;
            }

            pages[renamingPageId].name = newName;
            updatePagesList();
            closeModal('renamePageModal');
            saveToLocalStorage();
        }

        function deletePage(pageId) {
            if (Object.keys(pages).length === 1) {
                alert('Cannot delete the last page');
                return;
            }

            if (confirm('Are you sure you want to delete this page?')) {
                delete pages[pageId];
                if (currentPage === pageId) {
                    currentPage = Object.keys(pages)[0];
                    loadPage(currentPage);
                }
                updatePagesList();
                saveToLocalStorage();
            }
        }

        function switchToPage(pageId) {
            saveCurrentPage();
            currentPage = pageId;
            loadPage(pageId);
            updatePagesList();
        }

        function loadPage(pageId) {
            const page = pages[pageId];
            if (!page) return;

            document.getElementById('visualEditor').innerHTML = page.content;
            syncVisualToCode();
            updatePreview();
        }

        function saveCurrentPage() {
            if (currentTab === 'visual') {
                pages[currentPage].content = document.getElementById('visualEditor').innerHTML;
            } else if (currentTab === 'code') {
                pages[currentPage].content = document.getElementById('codeEditor').value;
            }
        }

        function updatePagesList() {
            const pagesList = document.getElementById('pagesList');
            pagesList.innerHTML = '';

            Object.keys(pages).forEach(pageId => {
                const page = pages[pageId];
                const pageItem = document.createElement('div');
                pageItem.className = 'page-item' + (pageId === currentPage ? ' active' : '');
                pageItem.setAttribute('data-page-id', pageId);
                pageItem.innerHTML = `
                    <span class="page-name" onclick="switchToPage('${pageId}')">${page.name}</span>
                    <div class="page-actions">
                        <button class="page-action" onclick="renamePage('${pageId}')" title="Rename">‚úèÔ∏è</button>
                        <button class="page-action" onclick="deletePage('${pageId}')" title="Delete">üóëÔ∏è</button>
                    </div>
                `;
                pagesList.appendChild(pageItem);
            });
        }

        // Editor functionality
        function switchTab(tab) {
            saveCurrentPage();
            currentTab = tab;

            // Update tab buttons
            document.querySelectorAll('.editor-tab').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            // Show/hide editors
            document.getElementById('visualEditor').style.display = tab === 'visual' ? 'block' : 'none';
            document.getElementById('codeEditor').style.display = tab === 'code' ? 'block' : 'none';
            document.getElementById('previewFrame').style.display = tab === 'preview' ? 'block' : 'none';

            if (tab === 'code') {
                syncVisualToCode();
            } else if (tab === 'visual') {
                syncCodeToVisual();
            } else if (tab === 'preview') {
                updatePreview();
            }
        }

        function formatText(command, value = null) {
            document.execCommand(command, false, value);
            document.getElementById('visualEditor').focus();
            syncVisualToCode();
        }

        function insertLink() {
            const selection = window.getSelection();
            const selectedText = selection.toString();
            document.getElementById('linkText').value = selectedText;
            document.getElementById('linkUrl').value = '';
            showModal('linkModal');
            document.getElementById('linkUrl').focus();
        }

        function confirmInsertLink() {
            const text = document.getElementById('linkText').value;
            const url = document.getElementById('linkUrl').value;
            
            if (!url) {
                alert('Please enter a URL');
                return;
            }

            const link = `<a href="${url}">${text || url}</a>`;
            document.execCommand('insertHTML', false, link);
            closeModal('linkModal');
            syncVisualToCode();
        }

        function insertImage() {
            showModal('imageModal');
            document.getElementById('imageUrl').value = '';
            document.getElementById('imageAlt').value = '';
            document.getElementById('imageUrl').focus();
        }

        function confirmInsertImage() {
            const url = document.getElementById('imageUrl').value;
            const alt = document.getElementById('imageAlt').value;
            
            if (!url) {
                alert('Please enter an image URL');
                return;
            }

            const img = `<img src="${url}" alt="${alt}" style="max-width: 100%; height: auto;">`;
            document.execCommand('insertHTML', false, img);
            closeModal('imageModal');
            syncVisualToCode();
        }

        function formatHTML(html) {
            let formatted = '';
            let indent = 0;
            const tab = '    '; // 4 spaces for indentation
            
            // Remove extra whitespace and split by tags
            html = html.replace(/>\s*</g, '><');
            const tokens = html.split(/(<[^>]*>)/);
            
            let i = 0;
            while (i < tokens.length) {
                const token = tokens[i];
                if (token.trim() === '') {
                    i++;
                    continue;
                }
                
                if (token.startsWith('</')) {
                    // Closing tag - decrease indent before adding
                    indent = Math.max(0, indent - 1);
                    formatted += tab.repeat(indent) + token + '\n';
                } else if (token.startsWith('<') && !token.endsWith('/>') && !isSelfClosing(token)) {
                    // Check if this is an inline element with text content
                    if (isInlineTag(token) && i + 2 < tokens.length && !tokens[i + 1].startsWith('<')) {
                        // Inline tag with text - keep on same line
                        const text = tokens[i + 1].trim();
                        const closingTag = tokens[i + 2];
                        if (text && closingTag && closingTag.startsWith('</')) {
                            formatted += tab.repeat(indent) + token + text + closingTag + '\n';
                            i += 3;
                            continue;
                        }
                    }
                    
                    // Regular opening tag
                    formatted += tab.repeat(indent) + token + '\n';
                    if (!isInlineTag(token)) {
                        indent++;
                    }
                } else if (token.startsWith('<')) {
                    // Self-closing tag
                    formatted += tab.repeat(indent) + token + '\n';
                } else {
                    // Text content
                    const trimmed = token.trim();
                    if (trimmed) {
                        formatted += tab.repeat(indent) + trimmed + '\n';
                    }
                }
                i++;
            }
            
            return formatted.replace(/\n\s*\n/g, '\n').trim();
        }
        
        function isSelfClosing(tag) {
            const selfClosingTags = ['img', 'br', 'hr', 'input', 'meta', 'link'];
            const tagName = tag.match(/<(\w+)/);
            return tagName && selfClosingTags.includes(tagName[1].toLowerCase());
        }
        
        function isInlineTag(tag) {
            const inlineTags = ['a', 'span', 'strong', 'em', 'b', 'i', 'u', 'small', 'code'];
            const tagName = tag.match(/<(\w+)/);
            return tagName && inlineTags.includes(tagName[1].toLowerCase());
        }

        function syncVisualToCode() {
            const rawHTML = document.getElementById('visualEditor').innerHTML;
            const formattedHTML = formatHTML(rawHTML);
            document.getElementById('codeEditor').value = formattedHTML;
        }

        function syncCodeToVisual() {
            document.getElementById('visualEditor').innerHTML = document.getElementById('codeEditor').value;
        }

        function formatHtmlCode() {
            if (currentTab === 'code') {
                const rawHTML = document.getElementById('codeEditor').value;
                const formattedHTML = formatHTML(rawHTML);
                document.getElementById('codeEditor').value = formattedHTML;
            } else {
                // If in visual tab, sync to code first then format
                syncVisualToCode();
            }
        }

        function updatePreview() {
            const content = pages[currentPage].content;
            const previewContent = `
                <!DOCTYPE html>
                <html lang="en">
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>${pages[currentPage].name}</title>
                    <style>
                        body {
                            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                            line-height: 1.6;
                            max-width: 800px;
                            margin: 0 auto;
                            padding: 2rem;
                        }
                        img { max-width: 100%; height: auto; }
                        blockquote {
                            margin: 1rem 0;
                            padding: 0.5rem 1rem;
                            border-left: 4px solid #3498db;
                            background: #f8f9fa;
                        }
                    </style>
                </head>
                <body>
                    ${content}
                </body>
                </html>
            `;
            
            const frame = document.getElementById('previewFrame');
            frame.srcdoc = previewContent;
        }

        // Modal functionality
        function showModal(modalId) {
            document.getElementById(modalId).classList.add('show');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('show');
        }

        // Project management
        function saveProject() {
            saveCurrentPage();
            const project = {
                pages: pages,
                currentPage: currentPage,
                pageIdCounter: pageIdCounter
            };
            
            const dataStr = JSON.stringify(project, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = 'website-project.json';
            link.click();
        }

        function loadProject() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const project = JSON.parse(e.target.result);
                        pages = project.pages;
                        currentPage = project.currentPage || Object.keys(pages)[0];
                        pageIdCounter = project.pageIdCounter || 1;
                        
                        updatePagesList();
                        loadPage(currentPage);
                        saveToLocalStorage();
                        alert('Project loaded successfully!');
                    } catch (error) {
                        alert('Error loading project file');
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        function exportProject() {
            saveCurrentPage();
            
            // Create navigation HTML
            const navLinks = Object.keys(pages).map(pageId => 
                `<a href="${pageId}.html">${pages[pageId].name}</a>`
            ).join(' | ');
            
            const navigation = `<nav style="margin-bottom: 2rem; padding-bottom: 1rem; border-bottom: 1px solid #ddd;">${navLinks}</nav>`;
            
            // Create ZIP-like structure (for demonstration, we'll create individual files)
            Object.keys(pages).forEach(pageId => {
                const page = pages[pageId];
                const htmlContent = `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${page.name}</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
        }
        nav a {
            margin-right: 1rem;
            color: #3498db;
            text-decoration: none;
        }
        nav a:hover {
            text-decoration: underline;
        }
        img { max-width: 100%; height: auto; }
        blockquote {
            margin: 1rem 0;
            padding: 0.5rem 1rem;
            border-left: 4px solid #3498db;
            background: #f8f9fa;
        }
    </style>
</head>
<body>
    ${navigation}
    ${page.content}
</body>
</html>`;
                
                const blob = new Blob([htmlContent], {type: 'text/html'});
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `${pageId}.html`;
                link.click();
            });
            
            alert('HTML files have been downloaded. Upload them to a web server to publish your website!');
        }

        // Local storage
        function saveToLocalStorage() {
            saveCurrentPage();
            const project = {
                pages: pages,
                currentPage: currentPage,
                pageIdCounter: pageIdCounter
            };
            localStorage.setItem('wysiwygEditor', JSON.stringify(project));
        }

        function loadFromLocalStorage() {
            const stored = localStorage.getItem('wysiwygEditor');
            if (stored) {
                try {
                    const project = JSON.parse(stored);
                    pages = project.pages || pages;
                    currentPage = project.currentPage || currentPage;
                    pageIdCounter = project.pageIdCounter || pageIdCounter;
                } catch (error) {
                    console.error('Error loading from localStorage:', error);
                }
            }
        }

        // Event listeners
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case 's':
                        e.preventDefault();
                        saveToLocalStorage();
                        break;
                    case 'b':
                        if (currentTab === 'visual') {
                            e.preventDefault();
                            formatText('bold');
                        }
                        break;
                    case 'i':
                        if (currentTab === 'visual') {
                            e.preventDefault();
                            formatText('italic');
                        }
                        break;
                    case 'u':
                        if (currentTab === 'visual') {
                            e.preventDefault();
                            formatText('underline');
                        }
                        break;
                }
            }
        });

        // Close modals when clicking outside
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal')) {
                e.target.classList.remove('show');
            }
        });

        // Initialize when page loads
        window.addEventListener('load', init);
        window.addEventListener('beforeunload', saveToLocalStorage);
    </script>
</body>
</html>